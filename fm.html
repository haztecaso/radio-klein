---
layout: default
title: FM
---

{% include player.html id="0" %}
{% include player.html id="1" %}

<h2>Programación<time>Huso horario UTC+2</time></h2>

<div class="tablecontainer">
<table>
  <tr>
    <th style="width:80px;"></th>
    <th>Domingo 11</th>
  </tr>
  <tr>
    <td>17:00</td>
    <td>Cutrinhos<br></td>
  </tr>
  <tr>
    <td>18:00</td>
    <td>Paréntesis</td>
  </tr>
</table>
</div>


<script type="text/javascript" src="{{ site.baseurl }}/assets/amplitude.js"></script>
<script>
//Configuración radios
stream_names = ["radiojuan","mpdroot"]; //Nombres de los streams, en el orden de los reproductores.
updateInterval = 1700; // Tiempo de actualización de los metadatos (en milisegundos)
url = "https://haztecaso.mooo.com:8085/"; //url del front-end encriptado de icecast (el del streaming es en :8000)

//Código guapo radios
amplitudesongs = [];
stream_names.forEach(function(name){
    amplitudesongs.push({
        "url": url+name,
        "live":true
    });
});

Amplitude.init({"songs": amplitudesongs});

function loadJSON(callback) {
	var xobj = new XMLHttpRequest();
	xobj.overrideMimeType("application/json");
	xobj.open('GET', 'https://haztecaso.mooo.com:8085/status-json.xsl', true);
	xobj.onreadystatechange = function () { if (xobj.readyState == 4 && xobj.status == "200") {callback(xobj.responseText);}};
	xobj.send(null);
}

function parseJSON(code){
    data = JSON.parse(code.replace(": - ",": \"sin metadatos\"")).icestats.source;
    if (!(data instanceof Array)){ data = [data]; }
    return data;
}

function update(){
    loadJSON(function(response) {
        data = parseJSON(response);
        //Esto es muy cutre jajaja
        stream_names.forEach(function(name,id,arr){
            data.forEach(function(stream){
                if (name == stream.listenurl.split(/[\s\/]+/).pop()){
                    document.querySelector("#player"+id+" .data .title").innerHTML     = stream.server_name;
                    document.querySelector("#player"+id+" .data .playing").innerHTML   = stream.title;
                    document.querySelector("#player"+id+" .data .listeners").innerHTML = stream.listeners;
                }
            });
        });
    });
}
update();
window.setInterval(update, updateInterval);
</script>
